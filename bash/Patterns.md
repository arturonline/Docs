# Patterns

Pattern matching serves two roles in the shell: selecting filenames within a directory, or determining whether a string conforms to a desired format.

BASH offers three different kinds of pattern matching:

- Glob Patterns
- Regular Expressions
- Brace Expansion

## Glob Patterns

Globs are basically patterns that can be used to match filenames or other strings.

Globs are composed of normal characters and metacharacters. These are the metacharacters that can be used in globs:

- `*`: Matches any string, including the null string.
- `?`: Matches any single character.
- `[...]`: Matches any one of the enclosed characters.

Globs are implicitly anchored at both ends. A glob of `a*` will not match the string cat, because it only matches the `at`, not the whole string. A glob of `ca*`, however, would match cat.

Example:

```bash
$ ls
a  abc  b  c
$ echo *
a abc b c
$ echo a*
a abc
```

### Globs in Parameter Expansion

Bash performs filename expansions after word splitting has already been done. Therefore, filenames generated by a glob will not be split; they will always be handled correctly. For example:

```bash
$ touch "a b.txt"
$ ls
# a b.txt
$ rm *
$ ls
# nothing
```

Here, `*` is expanded into the single filename `"a b.txt"`. This filename will be passed as a single argument to rm. Using globs to enumerate files is always a better idea than using `ls` for that purpose.

>⚠️ You should always use globs instead of ls (or similar) to enumerate files. Globs will always expand safely and minimize the risk for bugs.

### Extended Globs

Bash also supports a feature called Extended Globs. These globs are more powerful in nature; technically, they are equivalent to regular expressions, although the syntax looks different than most people are used to. This feature is turned off by default, but can be turned on with the shopt command, which is used to toggle shell options:

```bash
shopt -s extglob
```

- `?(list)`: Matches zero or one occurrence of the given patterns.
- `*(list)`: Matches zero or more occurrences of the given patterns.
- `+(list)`: Matches one or more occurrences of the given patterns.
- `@(list)`: Matches one of the given patterns.
- `!(list)`: Matches anything but the given patterns.

The list inside the parentheses is a list of globs or extended globs separated by the | character. Here's an example:

```bash
$ ls
names.txt  tokyo.jpg  california.bmp
$ echo !(*jpg|*bmp)
names.txt
```

Our extended glob expands to anything that does not match the *jpg or the *bmp pattern. Only the text file passes for that, so it is expanded.

## Regular Expressions

Bash uses the Extended Regular Expression (ERE) dialect. Regular expressions (regex) can only be used for pattern matching, not for filename matching.

Since 3.0, Bash supports the `=~` operator to the `[[` keyword. This operator matches the string that comes before it against the regex pattern that follows it. When the string matches the pattern, `[[` returns with an exit code of 0 ("*true*"). If the string does not match the pattern, an exit code of 1 ("*false*") is returned. In case the pattern's syntax is invalid, `[[` will abort the operation and return an exit code of 2.

```bash
$ langRegex='(..)_(..)'
$ if [[ $LANG =~ $langRegex ]]
> then
>     echo "Your country code (ISO 3166-1-alpha-2) is ${BASH_REMATCH[2]}."
>     echo "Your language code (ISO 639-1) is ${BASH_REMATCH[1]}."
> else
>     echo "Your locale was not recognised"
> fi
```

## Brace Expansion

Globs only expand to actual filenames, but brace expansions will expand to any possible permutation of their contents. Here's how they work:

```bash
$ echo th{e,a}n
then than
$ echo {/home/*,/root}/.*profile
/home/axxo/.bash_profile /home/lhunath/.profile /root/.bash_profile /root/.profile
$ echo {1..9}
1 2 3 4 5 6 7 8 9
$ echo {0,1}{0..9}
00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19
```

The brace expansion is replaced by a list of words, just like a glob is. However, these words aren't necessarily filenames, and they are not sorted (than would have come before then if they were).

Brace expansion happens before filename expansion. In the second echo command above, we used a combination of brace expansion and globs. The brace expansion goes first, and we get:

```bash
echo /home/*/.*profile /root/.*profile
```

After the brace expansion, the globs are expanded, and we get the filenames as the final result.

>⚠️ Brace expansions can only be used to generate lists of words. They cannot be used for pattern matching.

There are a few interesting and not very intuitive differences between ranges in character classes like `[a-z]` and brace expansion. For example, brace expansion allows counting backward, as can be seen with `{5..1}` or even `{b..Y}`, whereas `[5-1]` isn't expanded by the shell. `[b-Y]` may or may not be expanded, depending on your locale. Also, character ranges in brace expansions ignore locale variables like `LANG` and `LC_COLLATE` and always use `ASCII` ordering. Globbing on the other hand is affected by language settings. The following fragment is an example for counting down and for displaying characters in the order of their ASCII codes:

```bash
$ echo {b..Y}
b a ` _ ^ ]  [ Z Y
```
